@page
@model SignalR.WebClient.Pages.TransactionDetailModel
@{
    ViewData["Title"] = "TransactionDetail";
}

<h2>TransactionDetail</h2>
<h3 id="message">Ready to connect...</h3>
<button class="btn btn-default" id="welcomeButton">Get Welcome</button>

@using Microsoft.Extensions.Options
@inject IOptions<AppSettings> settings

@section Scripts {

    <script type="text/javascript">

        var messageComponant = document.getElementById("message");
        var welcomeButton = document.getElementById("welcomeButton");

            // establish connection to signalrhub using url sepcified in appsettings -Sahil 09-08-2019
            var connection = new signalR.HubConnectionBuilder().withUrl("@settings.Value.SignalRHubUrl/notificationhub").build();
            messageComponant.innerHTML = "Connecting...";

            // call when signalr connaction established -Sahil 09-08-2019 
            connection.start().then(function () {
                messageComponant.innerHTML = "Connection done.. waiting for welcome message..";
            }).catch(function (err) {
                    return console.error(err.toString());
            });

            // call when signalr hub send message through WelcomeMessage params -Sahil 09-08-2019
            connection.on("WelcomeMessage", function (message) {
                messageComponant.innerHTML = message;
            });

            welcomeButton.addEventListener("click", function (event) {
                    connection.invoke("SendWelcomeMessage").catch(function (err) {
                    return console.error(err.toString());
                    });
                    event.preventDefault();
                });

    </script>

}
